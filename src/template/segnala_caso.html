<section class="segnalazione-container">
    <header class="page-header">
        <h1>Apri un nuovo fascicolo</h1>
        <p>Hai informazioni su un caso non ancora trattato? Compila il rapporto preliminare con tutti i dettagli disponibili.</p>
    </header>

    <div id="feedback-area">
        <!-- I messaggi di feedback appariranno qui -->
    </div>

    <div class="form-wrapper">
        <form action="{{PATH_PREFIX}}/segnala-caso" method="POST" class="form-crimine" id="form-segnalazione">
            
            <!-- ========================================
                 SEZIONE 1: INFORMAZIONI GENERALI DEL CASO
                 ======================================== -->
            <fieldset class="form-section">
                <legend>üìã Informazioni Generali del Caso</legend>
                
                <div class="form-group">
                    <label for="titolo">Nome del Caso (Titolo) *</label>
                    <input type="text" 
                        id="titolo" 
                        name="titolo" 
                        placeholder="Es. Il mistero di..." 
                        required
                        minlength="5"
                        maxlength="200"
                        aria-describedby="titolo-hint"
                    />
                    <small id="titolo-hint" class="form-hint">Minimo 5 caratteri, massimo 200</small>
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label for="data_crimine">Data Accaduto *</label>
                        <input type="date" 
                            id="data_crimine" 
                            name="data_crimine" 
                            required
                        />
                    </div>
                    <div class="form-group half">
                        <label for="luogo">Luogo *</label>
                        <input 
                            type="text" 
                            id="luogo" 
                            name="luogo" 
                            placeholder="Citt√†, Paese" 
                            required
                            maxlength="100"
                        />
                    </div>
                </div>

                <div class="form-group">
                    <label for="tipologia">Categoria del Caso</label>
                    <select id="tipologia" name="tipologia">
                        <option value="">-- Seleziona una categoria (opzionale) --</option>
                        <option value="Serial killer">Serial killer</option>
                        <option value="Amore tossico">Amore tossico</option>
                        <option value="Celebrity">Celebrity</option>
                        <option value="Casi mediatici italiani">Casi mediatici italiani</option>
                        <option value="Casi irrisolti">Casi irrisolti</option>
                        <option value="Altro">Altro</option>
                    </select>
                    <small class="form-hint">Seleziona la categoria pi√π appropriata per il caso</small>
                </div>

                <div class="form-group">
                    <label for="descrizione_breve">Descrizione Breve *</label>
                    <textarea 
                        id="descrizione_breve" 
                        name="descrizione_breve" 
                        rows="3" 
                        placeholder="Una sintesi del caso in poche righe (apparir√† nelle anteprime)"
                        required
                        maxlength="500"
                        aria-describedby="descrizione-breve-hint"
                    ></textarea>
                    <small id="descrizione-breve-hint" class="form-hint">Massimo 500 caratteri</small>
                </div>

                <div class="form-group">
                    <label for="storia">Ricostruzione Completa / Storia del Caso *</label>
                    <textarea 
                        id="storia" 
                        name="storia" 
                        rows="15" 
                        placeholder="Descrivi in dettaglio la sequenza degli eventi, le circostanze, le indagini, il processo e l'esito finale..."
                        required
                        minlength="50"
                        maxlength="10000"
                        aria-describedby="storia-hint"
                    ></textarea>
                    <small id="storia-hint" class="form-hint">Minimo 50 caratteri, massimo 10.000 caratteri. Fornisci quanti pi√π dettagli possibile.</small>
                </div>
            </fieldset>

            <!-- ========================================
                 SEZIONE 2: VITTIME
                 ======================================== -->
            <fieldset class="form-section">
                <legend>üë§ Vittime del Caso</legend>
                <p class="section-intro">Aggiungi informazioni sulle vittime coinvolte nel caso. Puoi aggiungere pi√π vittime cliccando su "Aggiungi un'altra vittima".</p>
                
                <div id="vittime-container">
                    <!-- Prima vittima (obbligatoria) -->
                    <div class="persona-entry vittima-entry" data-index="0">
                        <div class="entry-header">
                            <h4>Vittima #1</h4>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group half">
                                <label for="vittima_nome_0">Nome *</label>
                                <input type="text" 
                                    id="vittima_nome_0" 
                                    name="vittima_nome[]" 
                                    placeholder="Nome" 
                                    required
                                    maxlength="50"
                                />
                            </div>
                            <div class="form-group half">
                                <label for="vittima_cognome_0">Cognome *</label>
                                <input type="text" 
                                    id="vittima_cognome_0" 
                                    name="vittima_cognome[]" 
                                    placeholder="Cognome" 
                                    required
                                    maxlength="50"
                                />
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group half">
                                <label for="vittima_luogo_nascita_0">Luogo di Nascita</label>
                                <input type="text" 
                                    id="vittima_luogo_nascita_0" 
                                    name="vittima_luogo_nascita[]" 
                                    placeholder="Citt√†, Paese" 
                                    maxlength="100"
                                />
                            </div>
                            <div class="form-group half">
                                <label for="vittima_data_nascita_0">Data di Nascita</label>
                                <input type="date" 
                                    id="vittima_data_nascita_0" 
                                    name="vittima_data_nascita[]"
                                />
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="vittima_data_decesso_0">Data di Decesso</label>
                            <input type="date" 
                                id="vittima_data_decesso_0" 
                                name="vittima_data_decesso[]"
                            />
                        </div>
                    </div>
                </div>

                <button type="button" class="btn-add-entry" id="btn-add-vittima">
                    ‚ûï Aggiungi un'altra vittima
                </button>
            </fieldset>

            <!-- ========================================
                 SEZIONE 3: COLPEVOLI
                 ======================================== -->
            <fieldset class="form-section">
                <legend>‚öñÔ∏è Colpevoli del Caso</legend>
                <p class="section-intro">Aggiungi informazioni sui colpevoli. Se il caso √® irrisolto, puoi lasciare questa sezione vuota o inserire "Ignoto".</p>
                
                <div id="colpevoli-container">
                    <!-- Primo colpevole (obbligatorio) -->
                    <div class="persona-entry colpevole-entry" data-index="0">
                        <div class="entry-header">
                            <h4>Colpevole #1</h4>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group half">
                                <label for="colpevole_nome_0">Nome *</label>
                                <input type="text" 
                                    id="colpevole_nome_0" 
                                    name="colpevole_nome[]" 
                                    placeholder="Nome (o 'Ignoto' se sconosciuto)" 
                                    required
                                    maxlength="50"
                                />
                            </div>
                            <div class="form-group half">
                                <label for="colpevole_cognome_0">Cognome *</label>
                                <input type="text" 
                                    id="colpevole_cognome_0" 
                                    name="colpevole_cognome[]" 
                                    placeholder="Cognome (o 'X' se sconosciuto)" 
                                    required
                                    maxlength="50"
                                />
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group half">
                                <label for="colpevole_luogo_nascita_0">Luogo di Nascita</label>
                                <input type="text" 
                                    id="colpevole_luogo_nascita_0" 
                                    name="colpevole_luogo_nascita[]" 
                                    placeholder="Citt√†, Paese (o 'N/A')" 
                                    maxlength="100"
                                />
                            </div>
                            <div class="form-group half">
                                <label for="colpevole_data_nascita_0">Data di Nascita</label>
                                <input type="date" 
                                    id="colpevole_data_nascita_0" 
                                    name="colpevole_data_nascita[]"
                                />
                            </div>
                        </div>
                    </div>
                </div>

                <button type="button" class="btn-add-entry" id="btn-add-colpevole">
                    ‚ûï Aggiungi un altro colpevole
                </button>
            </fieldset>

            <!-- ========================================
                 SEZIONE 4: FONTI E ARTICOLI
                 ======================================== -->
            <fieldset class="form-section">
                <legend>üì∞ Fonti e Articoli di Approfondimento</legend>
                <p class="section-intro">Aggiungi le fonti giornalistiche o documentali che supportano la ricostruzione del caso.</p>
                
                <div id="articoli-container">
                    <!-- Primo articolo (opzionale ma consigliato) -->
                    <div class="articolo-entry" data-index="0">
                        <div class="entry-header">
                            <h4>Fonte #1</h4>
                        </div>
                        
                        <div class="form-group">
                            <label for="articolo_titolo_0">Titolo Articolo/Fonte</label>
                            <input type="text" 
                                id="articolo_titolo_0" 
                                name="articolo_titolo[]" 
                                placeholder="Es. 'Approfondimento su...'" 
                                maxlength="200"
                            />
                        </div>

                        <div class="form-row">
                            <div class="form-group half">
                                <label for="articolo_data_0">Data Pubblicazione</label>
                                <input type="date" 
                                    id="articolo_data_0" 
                                    name="articolo_data[]"
                                />
                            </div>
                            <div class="form-group half">
                                <label for="articolo_link_0">Link Fonte</label>
                                <input type="url" 
                                    id="articolo_link_0" 
                                    name="articolo_link[]" 
                                    placeholder="https://esempio.it/articolo"
                                />
                            </div>
                        </div>
                    </div>
                </div>

                <button type="button" class="btn-add-entry" id="btn-add-articolo">
                    ‚ûï Aggiungi un'altra fonte
                </button>
            </fieldset>

            <!-- ========================================
                 NOTA FINALE E INVIO
                 ======================================== -->
            <div class="form-notice">
                <p><strong>üìã Nota importante:</strong></p>
                <ul>
                    <li>La segnalazione verr√† inviata al team di moderazione per la revisione</li>
                    <li>Solo i casi verificati e con fonti attendibili verranno pubblicati</li>
                    <li>Pi√π informazioni fornisci, pi√π veloce sar√† il processo di approvazione</li>
                    <li>Puoi lasciare campi opzionali vuoti se non hai le informazioni</li>
                </ul>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-submit">üì§ Invia Segnalazione Completa</button>
                <button type="reset" class="btn-reset" onclick="return confirm('Sei sicuro di voler cancellare tutti i dati inseriti?');">‚Ü∫ Cancella Tutto</button>
            </div>

        </form>
    </div>
</section>

<script>
// Script per gestire l'aggiunta dinamica di vittime, colpevoli e articoli
document.addEventListener('DOMContentLoaded', function() {
    
    // ========================================
    // GESTIONE VITTIME
    // ========================================
    let vittimeCount = 1;
    const vittimeContainer = document.getElementById('vittime-container');
    const btnAddVittima = document.getElementById('btn-add-vittima');

    btnAddVittima.addEventListener('click', function() {
        const newEntry = createVittimaEntry(vittimeCount);
        vittimeContainer.insertAdjacentHTML('beforeend', newEntry);
        vittimeCount++;
    });

    function createVittimaEntry(index) {
        return `
        <div class="persona-entry vittima-entry" data-index="${index}">
            <div class="entry-header">
                <h4>Vittima #${index + 1}</h4>
                <button type="button" class="btn-remove-entry" onclick="removeEntry(this)">üóëÔ∏è Rimuovi</button>
            </div>
            
            <div class="form-row">
                <div class="form-group half">
                    <label for="vittima_nome_${index}">Nome *</label>
                    <input type="text" 
                        id="vittima_nome_${index}" 
                        name="vittima_nome[]" 
                        placeholder="Nome" 
                        required
                        maxlength="50"
                    />
                </div>
                <div class="form-group half">
                    <label for="vittima_cognome_${index}">Cognome *</label>
                    <input type="text" 
                        id="vittima_cognome_${index}" 
                        name="vittima_cognome[]" 
                        placeholder="Cognome" 
                        required
                        maxlength="50"
                    />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group half">
                    <label for="vittima_luogo_nascita_${index}">Luogo di Nascita</label>
                    <input type="text" 
                        id="vittima_luogo_nascita_${index}" 
                        name="vittima_luogo_nascita[]" 
                        placeholder="Citt√†, Paese" 
                        maxlength="100"
                    />
                </div>
                <div class="form-group half">
                    <label for="vittima_data_nascita_${index}">Data di Nascita</label>
                    <input type="date" 
                        id="vittima_data_nascita_${index}" 
                        name="vittima_data_nascita[]"
                    />
                </div>
            </div>

            <div class="form-group">
                <label for="vittima_data_decesso_${index}">Data di Decesso</label>
                <input type="date" 
                    id="vittima_data_decesso_${index}" 
                    name="vittima_data_decesso[]"
                />
            </div>
        </div>
        `;
    }

    // ========================================
    // GESTIONE COLPEVOLI
    // ========================================
    let colpevoliCount = 1;
    const colpevoliContainer = document.getElementById('colpevoli-container');
    const btnAddColpevole = document.getElementById('btn-add-colpevole');

    btnAddColpevole.addEventListener('click', function() {
        const newEntry = createColpevoleEntry(colpevoliCount);
        colpevoliContainer.insertAdjacentHTML('beforeend', newEntry);
        colpevoliCount++;
    });

    function createColpevoleEntry(index) {
        return `
        <div class="persona-entry colpevole-entry" data-index="${index}">
            <div class="entry-header">
                <h4>Colpevole #${index + 1}</h4>
                <button type="button" class="btn-remove-entry" onclick="removeEntry(this)">üóëÔ∏è Rimuovi</button>
            </div>
            
            <div class="form-row">
                <div class="form-group half">
                    <label for="colpevole_nome_${index}">Nome *</label>
                    <input type="text" 
                        id="colpevole_nome_${index}" 
                        name="colpevole_nome[]" 
                        placeholder="Nome (o 'Ignoto' se sconosciuto)" 
                        required
                        maxlength="50"
                    />
                </div>
                <div class="form-group half">
                    <label for="colpevole_cognome_${index}">Cognome *</label>
                    <input type="text" 
                        id="colpevole_cognome_${index}" 
                        name="colpevole_cognome[]" 
                        placeholder="Cognome (o 'X' se sconosciuto)" 
                        required
                        maxlength="50"
                    />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group half">
                    <label for="colpevole_luogo_nascita_${index}">Luogo di Nascita</label>
                    <input type="text" 
                        id="colpevole_luogo_nascita_${index}" 
                        name="colpevole_luogo_nascita[]" 
                        placeholder="Citt√†, Paese (o 'N/A')" 
                        maxlength="100"
                    />
                </div>
                <div class="form-group half">
                    <label for="colpevole_data_nascita_${index}">Data di Nascita</label>
                    <input type="date" 
                        id="colpevole_data_nascita_${index}" 
                        name="colpevole_data_nascita[]"
                    />
                </div>
            </div>
        </div>
        `;
    }

    // ========================================
    // GESTIONE ARTICOLI
    // ========================================
    let articoliCount = 1;
    const articoliContainer = document.getElementById('articoli-container');
    const btnAddArticolo = document.getElementById('btn-add-articolo');

    btnAddArticolo.addEventListener('click', function() {
        const newEntry = createArticoloEntry(articoliCount);
        articoliContainer.insertAdjacentHTML('beforeend', newEntry);
        articoliCount++;
    });

    function createArticoloEntry(index) {
        return `
        <div class="articolo-entry" data-index="${index}">
            <div class="entry-header">
                <h4>Fonte #${index + 1}</h4>
                <button type="button" class="btn-remove-entry" onclick="removeEntry(this)">üóëÔ∏è Rimuovi</button>
            </div>
            
            <div class="form-group">
                <label for="articolo_titolo_${index}">Titolo Articolo/Fonte</label>
                <input type="text" 
                    id="articolo_titolo_${index}" 
                    name="articolo_titolo[]" 
                    placeholder="Es. 'Approfondimento su...'" 
                    maxlength="200"
                />
            </div>

            <div class="form-row">
                <div class="form-group half">
                    <label for="articolo_data_${index}">Data Pubblicazione</label>
                    <input type="date" 
                        id="articolo_data_${index}" 
                        name="articolo_data[]"
                    />
                </div>
                <div class="form-group half">
                    <label for="articolo_link_${index}">Link Fonte</label>
                    <input type="url" 
                        id="articolo_link_${index}" 
                        name="articolo_link[]" 
                        placeholder="https://esempio.it/articolo"
                    />
                </div>
            </div>
        </div>
        `;
    }
});

// Funzione globale per rimuovere entry
function removeEntry(button) {
    const entry = button.closest('.persona-entry, .articolo-entry');
    if (entry) {
        // Conferma prima di rimuovere
        if (confirm('Sei sicuro di voler rimuovere questa entry?')) {
            entry.remove();
        }
    }
}
</script>
